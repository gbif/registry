<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

  <changeSet id="176" author="auzun" runInTransaction="false">
    <sql splitStatements="false" stripComments="false">
      <![CDATA[
      -- Recreate normalize_name with explicit search_path
      CREATE OR REPLACE FUNCTION normalize_name(input text)
      RETURNS text AS
      $$
      BEGIN
          RETURN regexp_replace(quote_literal(unaccent(lower(trim(input)))),'\s+','','g');
      END;
      $$
      LANGUAGE plpgsql
      IMMUTABLE
      RETURNS NULL ON NULL INPUT
      SET search_path = public, pg_catalog;

      -- Recreate normalize_identifier with explicit search_path
      CREATE OR REPLACE FUNCTION normalize_identifier(input text)
      RETURNS text AS
      $$
      BEGIN
          RETURN regexp_replace(trim(input), 'http://|https://|urn:uuid:|urn:lsid:', '');
      END;
      $$
      LANGUAGE plpgsql
      IMMUTABLE
      RETURNS NULL ON NULL INPUT
      SET search_path = public, pg_catalog;
      ]]>
    </sql>
  </changeSet>
</databaseChangeLog>

